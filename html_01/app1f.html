<!DOCTYPE html>
<html>
<head>
 <meta charset="UTF-8">
 <title>TSV Viewer</title>
 <style>
  body {
   font-family: sans-serif;
   margin: 20px;
  }
  table, th, td {
   border: 1px solid black;
   border-collapse: collapse;
   padding: 4px;
  }
  #drop-zone {
   border: 2px dashed #888;
   padding: 20px;
   margin-top: 10px;
   width: 300px;
   text-align: center;
   color: #666;
  }
 </style>
</head>

<body>
 <h2>TSV Viewer (app1f.html)</h2>

 <!-- LOCAL MODE UI -->
 <div id="local-loader">
  <label>Select TSV file: </label>
  <input id="file-input" type="file" accept=".tsv">

  <div id="drop-zone">Drop TSV file here</div>
 </div>

 <!-- SERVER MODE UI -->
 <div id="server-picker-container" style="display:none; margin: 1em 0;">
  <label for="server-file-select">Choose a TSV file:</label>
  <select id="server-file-select"></select>
  <button id="load-server-file">Load</button>
 </div>

 <div id="output"></div>

 <script>
  function parseTSV(text) {
   let lines = text.trim().split(/\r?\n/);
   return lines.map(line => line.split("\t"));
  }

  function renderTable(rows) {
   let html = "<table>";
   for (let row of rows) {
    html += "<tr>";
    for (let cell of row) {
     html += "<td>" + cell + "</td>";
    }
    html += "</tr>";
   }
   html += "</table>";
   return html;
  }

  function loadTSVText(text, filename) {
   let rows = parseTSV(text);
   document.getElementById("output").innerHTML = "<h3>" + filename + "</h3>" + renderTable(rows);
  }

  document.addEventListener("DOMContentLoaded", () => {
   const isLocal = location.protocol === "file:";
   const dropZone = document.getElementById("drop-zone");
   const fileInput = document.getElementById("file-input");
   const localLoader = document.getElementById("local-loader");
   const serverPicker = document.getElementById("server-picker-container");

   if (isLocal) {
    // LOCAL MODE â€” unchanged
    localLoader.style.display = "block";
    serverPicker.style.display = "none";

    fileInput.addEventListener("change", evt => {
     let file = evt.target.files[0];
     if (!file) return;
     let reader = new FileReader();
     reader.onload = e => loadTSVText(e.target.result, file.name);
     reader.readAsText(file);
    });

    dropZone.addEventListener("dragover", evt => {
     evt.preventDefault();
     dropZone.style.background = "#eef";
    });

    dropZone.addEventListener("dragleave", evt => {
     evt.preventDefault();
     dropZone.style.background = "";
    });

    dropZone.addEventListener("drop", evt => {
     evt.preventDefault();
     dropZone.style.background = "";
     let file = evt.dataTransfer.files[0];
     if (!file) return;
     let reader = new FileReader();
     reader.onload = e => loadTSVText(e.target.result, file.name);
     reader.readAsText(file);
    });

    return;
   }

   // SERVER MODE
   localLoader.style.display = "none";
   serverPicker.style.display = "block";

   fetch("data/manifest.json")
    .then(r => r.json())
    .then(files => {
     const select = document.getElementById("server-file-select");
     files.forEach(f => {
      if (f.endsWith(".tsv")) {
       let opt = document.createElement("option");
       opt.value = f;
       opt.textContent = f;
       select.appendChild(opt);
      }
     });
    });

   document.getElementById("load-server-file").addEventListener("click", () => {
    const filename = document.getElementById("server-file-select").value;
    if (!filename) return;

    fetch("data/" + filename)
     .then(r => r.text())
     .then(text => loadTSVText(text, filename));
   });
  });
 </script>
</body>
</html>
